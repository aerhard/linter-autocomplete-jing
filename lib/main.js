"use strict";var t=require("atom"),e=require("net"),r=require("cross-spawn"),n=require("path"),o=require("sax");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=a(r),u=a(n),s=a(o);var c=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(t){var e={exports:{}};return t(e,e.exports),e.exports}var p="object"==typeof l&&l&&l.Object===Object&&l,v="object"==typeof self&&self&&self.Object===Object&&self,d=p||v||Function("return this")(),h=d.Symbol,g=Object.prototype,m=g.hasOwnProperty,y=g.toString,b=h?h.toStringTag:void 0;var _=function(t){var e=m.call(t,b),r=t[b];try{t[b]=void 0;var n=!0}catch(t){}var o=y.call(t);return n&&(e?t[b]=r:delete t[b]),o},x=Object.prototype.toString;var j=function(t){return x.call(t)},w=h?h.toStringTag:void 0;var P=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":w&&w in Object(t)?_(t):j(t)};var A=function(t){return null!=t&&"object"==typeof t};var I=function(t){return A(t)&&"[object Arguments]"==P(t)},$=Object.prototype,S=$.hasOwnProperty,O=$.propertyIsEnumerable,R=I(function(){return arguments}())?I:function(t){return A(t)&&S.call(t,"callee")&&!O.call(t,"callee")},F=Array.isArray,E=h?h.isConcatSpreadable:void 0;var T=function(t){return F(t)||R(t)||!!(E&&t&&t[E])};var k=function t(e,r,n,o,a){var i=-1,u=e.length;for(n||(n=T),a||(a=[]);++i<u;){var s=e[i];r>0&&n(s)?r>1?t(s,r-1,n,o,a):c(a,s):o||(a[a.length]=s)}return a};var C=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e};var D=function(){var t=arguments.length;if(!t)return[];for(var e=Array(t-1),r=arguments[0],n=t;n--;)e[n-1]=arguments[n];return c(F(r)?C(r):[r],k(e,1))};var L=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},B=function(){return d.Date.now()};var z=function(t){return"symbol"==typeof t||A(t)&&"[object Symbol]"==P(t)},N=/^\s+|\s+$/g,U=/^[-+]0x[0-9a-f]+$/i,q=/^0b[01]+$/i,M=/^0o[0-7]+$/i,V=parseInt;var W=function(t){if("number"==typeof t)return t;if(z(t))return NaN;if(L(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=L(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(N,"");var r=q.test(t);return r||M.test(t)?V(t.slice(2),r?2:8):U.test(t)?NaN:+t},G=Math.max,Y=Math.min;var Z=function(t,e,r){var n,o,a,i,u,s,c=0,l=!1,f=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){var r=n,a=o;return n=o=void 0,c=e,i=t.apply(a,r)}function d(t){return c=t,u=setTimeout(g,e),l?v(t):i}function h(t){var r=t-s;return void 0===s||r>=e||r<0||f&&t-c>=a}function g(){var t=B();if(h(t))return m(t);u=setTimeout(g,function(t){var r=e-(t-s);return f?Y(r,a-(t-c)):r}(t))}function m(t){return u=void 0,p&&n?v(t):(n=o=void 0,i)}function y(){var t=B(),r=h(t);if(n=arguments,o=this,s=t,r){if(void 0===u)return d(s);if(f)return clearTimeout(u),u=setTimeout(g,e),v(s)}return void 0===u&&(u=setTimeout(g,e)),i}return e=W(e)||0,L(r)&&(l=!!r.leading,a=(f="maxWait"in r)?G(W(r.maxWait)||0,e):a,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==u&&clearTimeout(u),c=0,n=s=o=u=void 0},y.flush=function(){return void 0===u?i:m(B())},y};var J=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,a=[];++r<n;){var i=t[r];e(i,r,t)&&(a[o++]=i)}return a};var X=function(t){return function(e,r,n){for(var o=-1,a=Object(e),i=n(e),u=i.length;u--;){var s=i[t?u:++o];if(!1===r(a[s],s,a))break}return e}}();var H=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var K=function(){return!1},Q=f((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?d.Buffer:void 0,a=(o?o.isBuffer:void 0)||K;t.exports=a})),tt=/^(?:0|[1-9]\d*)$/;var et=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&tt.test(t))&&t>-1&&t%1==0&&t<e};var rt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},nt={};nt["[object Float32Array]"]=nt["[object Float64Array]"]=nt["[object Int8Array]"]=nt["[object Int16Array]"]=nt["[object Int32Array]"]=nt["[object Uint8Array]"]=nt["[object Uint8ClampedArray]"]=nt["[object Uint16Array]"]=nt["[object Uint32Array]"]=!0,nt["[object Arguments]"]=nt["[object Array]"]=nt["[object ArrayBuffer]"]=nt["[object Boolean]"]=nt["[object DataView]"]=nt["[object Date]"]=nt["[object Error]"]=nt["[object Function]"]=nt["[object Map]"]=nt["[object Number]"]=nt["[object Object]"]=nt["[object RegExp]"]=nt["[object Set]"]=nt["[object String]"]=nt["[object WeakMap]"]=!1;var ot=function(t){return A(t)&&rt(t.length)&&!!nt[P(t)]};var at=function(t){return function(e){return t(e)}},it=f((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&p.process,a=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a})),ut=it&&it.isTypedArray,st=ut?at(ut):ot,ct=Object.prototype.hasOwnProperty;var lt=function(t,e){var r=F(t),n=!r&&R(t),o=!r&&!n&&Q(t),a=!r&&!n&&!o&&st(t),i=r||n||o||a,u=i?H(t.length,String):[],s=u.length;for(var c in t)!e&&!ct.call(t,c)||i&&("length"==c||o&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||et(c,s))||u.push(c);return u},ft=Object.prototype;var pt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ft)};var vt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),dt=Object.prototype.hasOwnProperty;var ht=function(t){if(!pt(t))return vt(t);var e=[];for(var r in Object(t))dt.call(t,r)&&"constructor"!=r&&e.push(r);return e};var gt=function(t){if(!L(t))return!1;var e=P(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e};var mt=function(t){return null!=t&&rt(t.length)&&!gt(t)};var yt=function(t){return mt(t)?lt(t):ht(t)};var bt=function(t,e){return function(r,n){if(null==r)return r;if(!mt(r))return t(r,n);for(var o=r.length,a=e?o:-1,i=Object(r);(e?a--:++a<o)&&!1!==n(i[a],a,i););return r}}((function(t,e){return t&&X(t,e,yt)}));var _t=function(t,e){var r=[];return bt(t,(function(t,n,o){e(t,n,o)&&r.push(t)})),r};var xt=function(){this.__data__=[],this.size=0};var jt=function(t,e){return t===e||t!=t&&e!=e};var wt=function(t,e){for(var r=t.length;r--;)if(jt(t[r][0],e))return r;return-1},Pt=Array.prototype.splice;var At=function(t){var e=this.__data__,r=wt(e,t);return!(r<0)&&(r==e.length-1?e.pop():Pt.call(e,r,1),--this.size,!0)};var It=function(t){var e=this.__data__,r=wt(e,t);return r<0?void 0:e[r][1]};var $t=function(t){return wt(this.__data__,t)>-1};var St=function(t,e){var r=this.__data__,n=wt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Ot(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ot.prototype.clear=xt,Ot.prototype.delete=At,Ot.prototype.get=It,Ot.prototype.has=$t,Ot.prototype.set=St;var Rt=Ot;var Ft=function(){this.__data__=new Rt,this.size=0};var Et=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var Tt=function(t){return this.__data__.get(t)};var kt,Ct=function(t){return this.__data__.has(t)},Dt=d["__core-js_shared__"],Lt=(kt=/[^.]+$/.exec(Dt&&Dt.keys&&Dt.keys.IE_PROTO||""))?"Symbol(src)_1."+kt:"";var Bt=function(t){return!!Lt&&Lt in t},zt=Function.prototype.toString;var Nt=function(t){if(null!=t){try{return zt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Ut=/^\[object .+?Constructor\]$/,qt=Function.prototype,Mt=Object.prototype,Vt=qt.toString,Wt=Mt.hasOwnProperty,Gt=RegExp("^"+Vt.call(Wt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Yt=function(t){return!(!L(t)||Bt(t))&&(gt(t)?Gt:Ut).test(Nt(t))};var Zt=function(t,e){return null==t?void 0:t[e]};var Jt=function(t,e){var r=Zt(t,e);return Yt(r)?r:void 0},Xt=Jt(d,"Map"),Ht=Jt(Object,"create");var Kt=function(){this.__data__=Ht?Ht(null):{},this.size=0};var Qt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},te=Object.prototype.hasOwnProperty;var ee=function(t){var e=this.__data__;if(Ht){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return te.call(e,t)?e[t]:void 0},re=Object.prototype.hasOwnProperty;var ne=function(t){var e=this.__data__;return Ht?void 0!==e[t]:re.call(e,t)};var oe=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ht&&void 0===e?"__lodash_hash_undefined__":e,this};function ae(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ae.prototype.clear=Kt,ae.prototype.delete=Qt,ae.prototype.get=ee,ae.prototype.has=ne,ae.prototype.set=oe;var ie=ae;var ue=function(){this.size=0,this.__data__={hash:new ie,map:new(Xt||Rt),string:new ie}};var se=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ce=function(t,e){var r=t.__data__;return se(e)?r["string"==typeof e?"string":"hash"]:r.map};var le=function(t){var e=ce(this,t).delete(t);return this.size-=e?1:0,e};var fe=function(t){return ce(this,t).get(t)};var pe=function(t){return ce(this,t).has(t)};var ve=function(t,e){var r=ce(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function de(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}de.prototype.clear=ue,de.prototype.delete=le,de.prototype.get=fe,de.prototype.has=pe,de.prototype.set=ve;var he=de;var ge=function(t,e){var r=this.__data__;if(r instanceof Rt){var n=r.__data__;if(!Xt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new he(n)}return r.set(t,e),this.size=r.size,this};function me(t){var e=this.__data__=new Rt(t);this.size=e.size}me.prototype.clear=Ft,me.prototype.delete=Et,me.prototype.get=Tt,me.prototype.has=Ct,me.prototype.set=ge;var ye=me;var be=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var _e=function(t){return this.__data__.has(t)};function xe(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new he;++e<r;)this.add(t[e])}xe.prototype.add=xe.prototype.push=be,xe.prototype.has=_e;var je=xe;var we=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Pe=function(t,e){return t.has(e)};var Ae=function(t,e,r,n,o,a){var i=1&r,u=t.length,s=e.length;if(u!=s&&!(i&&s>u))return!1;var c=a.get(t),l=a.get(e);if(c&&l)return c==e&&l==t;var f=-1,p=!0,v=2&r?new je:void 0;for(a.set(t,e),a.set(e,t);++f<u;){var d=t[f],h=e[f];if(n)var g=i?n(h,d,f,e,t,a):n(d,h,f,t,e,a);if(void 0!==g){if(g)continue;p=!1;break}if(v){if(!we(e,(function(t,e){if(!Pe(v,e)&&(d===t||o(d,t,r,n,a)))return v.push(e)}))){p=!1;break}}else if(d!==h&&!o(d,h,r,n,a)){p=!1;break}}return a.delete(t),a.delete(e),p},Ie=d.Uint8Array;var $e=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Se=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Oe=h?h.prototype:void 0,Re=Oe?Oe.valueOf:void 0;var Fe=function(t,e,r,n,o,a,i){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new Ie(t),new Ie(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return jt(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=$e;case"[object Set]":var s=1&n;if(u||(u=Se),t.size!=e.size&&!s)return!1;var c=i.get(t);if(c)return c==e;n|=2,i.set(t,e);var l=Ae(u(t),u(e),n,o,a,i);return i.delete(t),l;case"[object Symbol]":if(Re)return Re.call(t)==Re.call(e)}return!1};var Ee=function(t,e,r){var n=e(t);return F(t)?n:c(n,r(t))};var Te=function(){return[]},ke=Object.prototype.propertyIsEnumerable,Ce=Object.getOwnPropertySymbols,De=Ce?function(t){return null==t?[]:(t=Object(t),J(Ce(t),(function(e){return ke.call(t,e)})))}:Te;var Le=function(t){return Ee(t,yt,De)},Be=Object.prototype.hasOwnProperty;var ze=function(t,e,r,n,o,a){var i=1&r,u=Le(t),s=u.length;if(s!=Le(e).length&&!i)return!1;for(var c=s;c--;){var l=u[c];if(!(i?l in e:Be.call(e,l)))return!1}var f=a.get(t),p=a.get(e);if(f&&p)return f==e&&p==t;var v=!0;a.set(t,e),a.set(e,t);for(var d=i;++c<s;){var h=t[l=u[c]],g=e[l];if(n)var m=i?n(g,h,l,e,t,a):n(h,g,l,t,e,a);if(!(void 0===m?h===g||o(h,g,r,n,a):m)){v=!1;break}d||(d="constructor"==l)}if(v&&!d){var y=t.constructor,b=e.constructor;y==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(v=!1)}return a.delete(t),a.delete(e),v},Ne=Jt(d,"DataView"),Ue=Jt(d,"Promise"),qe=Jt(d,"Set"),Me=Jt(d,"WeakMap"),Ve=Nt(Ne),We=Nt(Xt),Ge=Nt(Ue),Ye=Nt(qe),Ze=Nt(Me),Je=P;(Ne&&"[object DataView]"!=Je(new Ne(new ArrayBuffer(1)))||Xt&&"[object Map]"!=Je(new Xt)||Ue&&"[object Promise]"!=Je(Ue.resolve())||qe&&"[object Set]"!=Je(new qe)||Me&&"[object WeakMap]"!=Je(new Me))&&(Je=function(t){var e=P(t),r="[object Object]"==e?t.constructor:void 0,n=r?Nt(r):"";if(n)switch(n){case Ve:return"[object DataView]";case We:return"[object Map]";case Ge:return"[object Promise]";case Ye:return"[object Set]";case Ze:return"[object WeakMap]"}return e});var Xe=Je,He=Object.prototype.hasOwnProperty;var Ke=function(t,e,r,n,o,a){var i=F(t),u=F(e),s=i?"[object Array]":Xe(t),c=u?"[object Array]":Xe(e),l="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),f="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),p=s==c;if(p&&Q(t)){if(!Q(e))return!1;i=!0,l=!1}if(p&&!l)return a||(a=new ye),i||st(t)?Ae(t,e,r,n,o,a):Fe(t,e,s,r,n,o,a);if(!(1&r)){var v=l&&He.call(t,"__wrapped__"),d=f&&He.call(e,"__wrapped__");if(v||d){var h=v?t.value():t,g=d?e.value():e;return a||(a=new ye),o(h,g,r,n,a)}}return!!p&&(a||(a=new ye),ze(t,e,r,n,o,a))};var Qe=function t(e,r,n,o,a){return e===r||(null==e||null==r||!A(e)&&!A(r)?e!=e&&r!=r:Ke(e,r,n,o,t,a))};var tr=function(t,e,r,n){var o=r.length,a=o,i=!n;if(null==t)return!a;for(t=Object(t);o--;){var u=r[o];if(i&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<a;){var s=(u=r[o])[0],c=t[s],l=u[1];if(i&&u[2]){if(void 0===c&&!(s in t))return!1}else{var f=new ye;if(n)var p=n(c,l,s,t,e,f);if(!(void 0===p?Qe(l,c,3,n,f):p))return!1}}return!0};var er=function(t){return t==t&&!L(t)};var rr=function(t){for(var e=yt(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,er(o)]}return e};var nr=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}};var or=function(t){var e=rr(t);return 1==e.length&&e[0][2]?nr(e[0][0],e[0][1]):function(r){return r===t||tr(r,t,e)}},ar=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ir=/^\w*$/;var ur=function(t,e){if(F(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!z(t))||(ir.test(t)||!ar.test(t)||null!=e&&t in Object(e))};function sr(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=t.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(sr.Cache||he),r}sr.Cache=he;var cr=sr;var lr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fr=/\\(\\)?/g,pr=function(t){var e=cr(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(lr,(function(t,r,n,o){e.push(n?o.replace(fr,"$1"):r||t)})),e}));var vr=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},dr=h?h.prototype:void 0,hr=dr?dr.toString:void 0;var gr=function t(e){if("string"==typeof e)return e;if(F(e))return vr(e,t)+"";if(z(e))return hr?hr.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r};var mr=function(t){return null==t?"":gr(t)};var yr=function(t,e){return F(t)?t:ur(t,e)?[t]:pr(mr(t))};var br=function(t){if("string"==typeof t||z(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var _r=function(t,e){for(var r=0,n=(e=yr(e,t)).length;null!=t&&r<n;)t=t[br(e[r++])];return r&&r==n?t:void 0};var xr=function(t,e,r){var n=null==t?void 0:_r(t,e);return void 0===n?r:n};var jr=function(t,e){return null!=t&&e in Object(t)};var wr=function(t,e,r){for(var n=-1,o=(e=yr(e,t)).length,a=!1;++n<o;){var i=br(e[n]);if(!(a=null!=t&&r(t,i)))break;t=t[i]}return a||++n!=o?a:!!(o=null==t?0:t.length)&&rt(o)&&et(i,o)&&(F(t)||R(t))};var Pr=function(t,e){return null!=t&&wr(t,e,jr)};var Ar=function(t,e){return ur(t)&&er(e)?nr(br(t),e):function(r){var n=xr(r,t);return void 0===n&&n===e?Pr(r,t):Qe(e,n,3)}};var Ir=function(t){return t};var $r=function(t){return function(e){return null==e?void 0:e[t]}};var Sr=function(t){return function(e){return _r(e,t)}};var Or=function(t){return ur(t)?$r(br(t)):Sr(t)};var Rr=function(t){return"function"==typeof t?t:null==t?Ir:"object"==typeof t?F(t)?Ar(t[0],t[1]):or(t):Or(t)};var Fr=function(t,e){return(F(t)?J:_t)(t,Rr(e))};var Er=function(t,e){var r=-1,n=mt(t)?Array(t.length):[];return bt(t,(function(t,o,a){n[++r]=e(t,o,a)})),n};var Tr=function(t,e){return(F(t)?vr:Er)(t,Rr(e))};var kr=function(t,e){return k(Tr(t,e),1)},Cr=Array.prototype.join;var Dr=function(t,e){return null==t?"":Cr.call(t,e)};var Lr=function(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t};var Br=function(t,e){if(t!==e){var r=void 0!==t,n=null===t,o=t==t,a=z(t),i=void 0!==e,u=null===e,s=e==e,c=z(e);if(!u&&!c&&!a&&t>e||a&&i&&s&&!u&&!c||n&&i&&s||!r&&s||!o)return 1;if(!n&&!a&&!c&&t<e||c&&r&&o&&!n&&!a||u&&r&&o||!i&&o||!s)return-1}return 0};var zr=function(t,e,r){for(var n=-1,o=t.criteria,a=e.criteria,i=o.length,u=r.length;++n<i;){var s=Br(o[n],a[n]);if(s)return n>=u?s:s*("desc"==r[n]?-1:1)}return t.index-e.index};var Nr=function(t,e,r){e=e.length?vr(e,(function(t){return F(t)?function(e){return _r(e,1===t.length?t[0]:t)}:t})):[Ir];var n=-1;e=vr(e,at(Rr));var o=Er(t,(function(t,r,o){return{criteria:vr(e,(function(e){return e(t)})),index:++n,value:t}}));return Lr(o,(function(t,e){return zr(t,e,r)}))};var Ur=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},qr=Math.max;var Mr=function(t,e,r){return e=qr(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,a=qr(n.length-e,0),i=Array(a);++o<a;)i[o]=n[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=n[o];return u[e]=r(i),Ur(t,this,u)}};var Vr=function(t){return function(){return t}},Wr=function(){try{var t=Jt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Gr=Wr?function(t,e){return Wr(t,"toString",{configurable:!0,enumerable:!1,value:Vr(e),writable:!0})}:Ir,Yr=Date.now;var Zr=function(t){var e=0,r=0;return function(){var n=Yr(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Gr);var Jr=function(t,e){return Zr(Mr(t,e,Ir),t+"")};var Xr=function(t,e,r){if(!L(r))return!1;var n=typeof e;return!!("number"==n?mt(r)&&et(e,r.length):"string"==n&&e in r)&&jt(r[e],t)},Hr=Jr((function(t,e){if(null==t)return[];var r=e.length;return r>1&&Xr(t,e[0],e[1])?e=[]:r>2&&Xr(e[0],e[1],e[2])&&(e=[e[0]]),Nr(t,k(e,1),[])}));var Kr=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(o);++n<o;)a[n]=t[n+e];return a};var Qr=function(t,e,r){var n=t.length;return r=void 0===r?n:r,!e&&r>=n?t:Kr(t,e,r)},tn=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var en=function(t){return tn.test(t)};var rn=function(t){return A(t)&&"[object RegExp]"==P(t)},nn=it&&it.isRegExp,on=nn?at(nn):rn;var an=function(t){return t.split("")},un="[\\ud800-\\udfff]",sn="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",cn="\\ud83c[\\udffb-\\udfff]",ln="[^\\ud800-\\udfff]",fn="(?:\\ud83c[\\udde6-\\uddff]){2}",pn="[\\ud800-\\udbff][\\udc00-\\udfff]",vn="(?:"+sn+"|"+cn+")"+"?",dn="[\\ufe0e\\ufe0f]?"+vn+("(?:\\u200d(?:"+[ln,fn,pn].join("|")+")[\\ufe0e\\ufe0f]?"+vn+")*"),hn="(?:"+[ln+sn+"?",sn,fn,pn,un].join("|")+")",gn=RegExp(cn+"(?="+cn+")|"+hn+dn,"g");var mn=function(t){return t.match(gn)||[]};var yn=function(t){return en(t)?mn(t):an(t)};var bn=function(t,e,r){return r&&"number"!=typeof r&&Xr(t,e,r)&&(e=r=void 0),(r=void 0===r?4294967295:r>>>0)?(t=mr(t))&&("string"==typeof e||null!=e&&!on(e))&&!(e=gr(e))&&en(t)?Qr(yn(t),0,r):t.split(e,r):[]};var _n=function(t,e,r){return t==t&&(void 0!==r&&(t=t<=r?t:r),void 0!==e&&(t=t>=e?t:e)),t};var xn=function(t){return t?Infinity===(t=W(t))||-Infinity===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var jn=function(t){var e=xn(t),r=e%1;return e==e?r?e-r:e:0};var wn=function(t,e,r){return t=mr(t),r=null==r?0:_n(jn(r),0,t.length),e=gr(e),t.slice(r,r+e.length)==e};var Pn=function(t){return(null==t?0:t.length)?k(t,1):[]};var An=function(t){return Zr(Mr(t,void 0,Pn),t+"")};var In=function(t){return An((function(e){return e=vr(e,at(Rr)),Jr((function(r){var n=this;return t(e,(function(t){return Ur(t,n,r)}))}))}))}((function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}));var $n=function(t){for(var e=-1,r=null==t?0:t.length,n=0,o=[];++e<r;){var a=t[e];a&&(o[n++]=a)}return o},Sn=Object.create,On=function(){function t(){}return function(e){if(!L(e))return{};if(Sn)return Sn(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var Rn=function(){};function Fn(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}Fn.prototype=On(Rn.prototype),Fn.prototype.constructor=Fn;var En=Fn,Tn=Me&&new Me;var kn=Tn?function(t){return Tn.get(t)}:function(){},Cn={},Dn=Object.prototype.hasOwnProperty;var Ln=function(t){for(var e=t.name+"",r=Cn[e],n=Dn.call(Cn,e)?r.length:0;n--;){var o=r[n],a=o.func;if(null==a||a==t)return o.name}return e};function Bn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}Bn.prototype=On(Rn.prototype),Bn.prototype.constructor=Bn;var zn=Bn;var Nn=function(t){if(t instanceof zn)return t.clone();var e=new En(t.__wrapped__,t.__chain__);return e.__actions__=C(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e},Un=Object.prototype.hasOwnProperty;function qn(t){if(A(t)&&!F(t)&&!(t instanceof zn)){if(t instanceof En)return t;if(Un.call(t,"__wrapped__"))return Nn(t)}return new En(t)}qn.prototype=Rn.prototype,qn.prototype.constructor=qn;var Mn=qn;var Vn=function(t){var e=Ln(t),r=Mn[e];if("function"!=typeof r||!(e in zn.prototype))return!1;if(t===r)return!0;var n=kn(r);return!!n&&t===n[0]};var Wn=function(t){return An((function(e){var r=e.length,n=r,o=En.prototype.thru;for(t&&e.reverse();n--;){var a=e[n];if("function"!=typeof a)throw new TypeError("Expected a function");if(o&&!i&&"wrapper"==Ln(a))var i=new En([],!0)}for(n=i?n:r;++n<r;){a=e[n];var u=Ln(a),s="wrapper"==u?kn(a):void 0;i=s&&Vn(s[0])&&424==s[1]&&!s[4].length&&1==s[9]?i[Ln(s[0])].apply(i,s[3]):1==a.length&&Vn(a)?i[u]():i.thru(a)}return function(){var t=arguments,n=t[0];if(i&&1==t.length&&F(n))return i.plant(n).value();for(var o=0,a=r?e[o].apply(this,t):n;++o<r;)a=e[o].call(this,a);return a}}))}();var Gn=function(t,e,r,n){for(var o=t.length,a=r+(n?1:-1);n?a--:++a<o;)if(e(t[a],a,t))return a;return-1};var Yn=function(t){return t!=t};var Zn=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var Jn=function(t,e,r){return e==e?Zn(t,e,r):Gn(t,Yn,r)};var Xn=function(t,e){for(var r=t.length;r--&&Jn(e,t[r],0)>-1;);return r};var Hn=function(t,e){for(var r=-1,n=t.length;++r<n&&Jn(e,t[r],0)>-1;);return r},Kn=/^\s+|\s+$/g;var Qn=function(t,e,r){if((t=mr(t))&&(r||void 0===e))return t.replace(Kn,"");if(!t||!(e=gr(e)))return t;var n=yn(t),o=yn(e),a=Hn(n,o),i=Xn(n,o)+1;return Qr(n,a,i).join("")};const to=t=>e=>Fr(e,t),eo=t=>e=>kr(e,t),ro=t=>e=>Tr(e,t),no=/XML Tools Server listening on port (\d+)/;function oo(){this.state=this.STOPPED,this.isReadyPromise=null,this.javaProcess=null,this.port=null}oo.prototype={STOPPED:"STOPPED",INITIALIZING:"INITIALIZING",READY:"READY",getState(){return this.state},isReady(){return this.state===this.READY},ensureIsReady(t){return this.isReadyPromise||(this.isReadyPromise=this.createIsReadyPromise(t)),this.isReadyPromise},createIsReadyPromise(t){return this.state=this.INITIALIZING,new Promise(((e,r)=>{const n=[...t.jvmArguments.split(/\s+/),"-jar",u.default.resolve(__dirname,"../vendor/xml-tools-server-0.4.8.jar"),0,t.schemaCacheSize];this.javaProcess=i.default(t.javaExecutablePath,n,{}),this.setStartupListeners(t,e,r)}))},setStartupListeners(t,e,r){const n=t=>{const n=t.toString().match(no);n?(this.port=Number(n[1]),this.removeListeners(),this.setExecutionListeners(),this.state=this.READY,e(this)):(r(new oo.Error(`Unexpected server start message "${t}"`)),this.exit())};this.javaProcess.stdout.on("data",n),this.javaProcess.stderr.on("data",n),this.javaProcess.on("error",(e=>{r(new oo.Error(`Failed to execute "${t.javaExecutablePath}".\nPlease adjust the Java executable path in the "linter-autocomplete-jing" package settings`,e)),this.exit()}))},onStdOut(){},onStdErr(t){console.error(`Server message on stderr: ${t}`)},onError(t){console.error("Server error:",t)},setExecutionListeners(){this.javaProcess.stdout.on("data",(t=>this.onStdOut(t))),this.javaProcess.stderr.on("data",(t=>this.onStdErr(t))),this.javaProcess.on("error",(t=>{this.onError(t),this.exit()}))},removeListeners(){this.javaProcess.stdout.removeAllListeners("data"),this.javaProcess.stderr.removeAllListeners("data"),this.javaProcess.removeAllListeners("error")},exit(){this.state=this.STOPPED,this.javaProcess&&(this.removeListeners(),this.javaProcess.kill(),this.javaProcess=null),this.isReadyPromise=null,this.port=null},sendRequest(t,r){const n=this.port;return new Promise(((o,a)=>{let i="";const u=new e.Socket;u.on("connect",(()=>{u.write(t.map((t=>`-${t}\n`)).join("")),null!==r&&(u.write("\n"),u.write(r)),u.end()})),u.on("data",(t=>{i+=t.toString()})),u.on("close",(()=>{o(i)})),u.on("error",(t=>{u.destroy(),a(t)})),u.connect({port:n})}))}};let ao=null;oo.getInstance=function(){return null===ao&&(ao=new oo),ao},oo.Error=function(t,e){this.name="ServerProcess.Error",this.message=t,this.stack=e?e.stack:(new Error).stack},oo.Error.prototype=Object.create(Error.prototype);const io=[":","A-Z","_","a-z","\\xC0-\\xD6","\\xD8-\\xF6","\\u00F8-\\u02FF","\\u0370-\\u037D","\\u037F-\\u1FFF","\\u200C-\\u200D","\\u2070-\\u218F","\\u2C00-\\u2FEF","\\u3001-\\uD7FF","\\uF900-\\uFDCF","\\uFDF0-\\uFFFD"].join(""),uo=[io,"\\-","\\.","0-9","\\u00B7","\\u0300-\\u036F","\\u203F-\\u2040"].join(""),so=["\\u0020","\\u0009","\\u000D","\\u000A"].join("");var co={tagNamePI:new RegExp(`<(!|/|/?[${io}][${uo}]*)?$`),attStartFromAttName:new RegExp(`(?:^|[${so}])([${io}][${uo}]*)?$`),attStartFromAttValueDouble:new RegExp(`([${io}][${uo}]*)="([^"]*)?`),attStartFromAttValueSingle:new RegExp(`([${io}][${uo}]*)='([^']*)?`),attEndFromAttName:new RegExp("^["+uo+"]*=(\".*?\"|'.*?')"),endToken:new RegExp(`(?:^|["${so}])([^${so}]+)$`),spaces:new RegExp(`[${so}]+`),url:/^(?:[a-z][a-z0-9+\-.]*:)?\/\//i,previousTagBracket:/"[^<]*?"|'[^<]*?'|<\/|<|>/g,nextTagBracket:/"[^<]*?"|'[^<]*?'|<|\/>|>/g,publicId:/\s*[^\s]+\s*PUBLIC\s*("([^"]+)"|'([^']+)')/};const lo=require("atom-linter"),fo=(t,e)=>e%2,po=(t,e,r)=>new Promise((n=>{const o=t.getPath(),a=o?u.default.dirname(o):__dirname,i=[],c=[],l=[],f=s.default.parser(!0);let p=0,v=!1,d=!1,h=null,g=null,m={},y=null;const b=t=>t&&l.push(co.url.test(t)?t:u.default.resolve(a,t));f.onerror=()=>v=!0,f.ondoctype=t=>{d=!0;const e=t.match(co.publicId);e&&(y=e[2]||e[3])},f.onprocessinginstruction=e=>{if("xml-model"!==e.name)return;const{href:r,type:n,schematypens:s}=(t=>{const e={};return t.replace(/(\w+)="(.+?)"/g,((t,r,n)=>e[r]=n)),e})(e.body);let l;r&&("application/relax-ng-compact-syntax"===n?l="rnc":"http://relaxng.org/ns/structure/1.0"===s?l=".rnc"===u.default.extname(r)?"rnc":"rng":"http://purl.oclc.org/dsdl/schematron"===s?l="sch.iso":"http://www.ascc.net/xml/schematron"===s?l="sch.15":"http://www.w3.org/2001/XMLSchema"===s?b(r):i.push({severity:"warning",excerpt:"Unknown schema type",location:{file:o,position:lo.generateRange(t,p)}})),l&&c.push({lang:l,line:p,path:co.url.test(r)?r:u.default.resolve(a,r)})},f.onopentag=t=>{if(v)return;const[e,r]=(t=>{const e=t.indexOf(":");return[t.substr(0,e),t.substr(e+1)]})(t.name);h=e?t.attributes["xmlns:"+e]:t.attributes.xmlns,g=r,m=t.attributes,(t=>{const e=[];return Object.keys(t).forEach((r=>{const n=r.match(/xmlns:(.*)/);n&&"http://www.w3.org/2001/XMLSchema-instance"===t[r]&&e.push(n[1])})),e})(t.attributes).forEach((e=>{const r=t.attributes[e+":noNamespaceSchemaLocation"];r&&b(r.trim());const n=t.attributes[e+":schemaLocation"];n&&n.trim().split(co.spaces).filter(fo).forEach(b)})),v=!0};const _=t.getBuffer(),x=_.getLineCount();for(;!v&&p<x;){const t=_.lineForRow(p),e=t.length;let r=0;for(;!v&&r<e;)f.write(t.substr(r,64)),r+=64;p++}l.length&&c.push({lang:"xsd",path:l.join("*")});const j={rootScopes:t.getRootScopeDescriptor().scopes,filePath:o,rootNs:h,rootLocalName:g,rootAttributes:m,publicId:y},w=e.find((t=>t.test(j))),P=w&&"xmlCatalog"in w.outcome?w.outcome.xmlCatalog:r.xmlCatalog,A=w&&"dtdValidation"in w.outcome?w.outcome.dtdValidation:r.dtdValidation,I=w&&"xIncludeAware"in w.outcome?w.outcome.xIncludeAware:r.xIncludeAware,$=w&&"xIncludeFixupBaseUris"in w.outcome?w.outcome.xIncludeFixupBaseUris:r.xIncludeFixupBaseUris,S=w&&"xIncludeFixupLanguage"in w.outcome?w.outcome.xIncludeFixupLanguage:r.xIncludeFixupLanguage;w&&"schemaProps"in w.outcome&&!c.length&&c.push(...w.outcome.schemaProps),d&&("always"===A||"fallback"===A&&!c.length)&&c.push({lang:"dtd",line:f.line,path:null}),c.length||c.push({lang:"none",path:null}),n({schemaProps:c,messages:i,xmlCatalog:P,xIncludeAware:I,xIncludeFixupBaseUris:$,xIncludeFixupLanguage:S})})),vo=require("atom-linter"),ho=/^([a-z0-9.]+?):((.*?):\s?)?((\d+):)?(?:\d+:\s)?(error|fatal|warning):\s(.*)$/,go=oo.getInstance(),mo=(t,e,r)=>{const{schemaProps:n,messages:o}=r,a=((t,e)=>{const{schemaProps:r,xmlCatalog:n,xIncludeAware:o,xIncludeFixupBaseUris:a,xIncludeFixupLanguage:i}=e;return["V","r"+(o?"x":"")+(a?"f":"")+(i?"l":""),"UTF-8",t.getPath(),n||"",...r.map((t=>t.lang+" "+(t.path||"")))]})(t,r),i=t.getText();return go.sendRequest(a,i).then(Wn(Qn,(u=/\r?\n/,t=>bn(t,u)),to(Ir),ro(((t,e,r)=>function(n){const o=ho.exec(n);if(!o)return console.error(`Could not parse message "${n}"`),null;const[,a,,i,,u,s,c]=o,l=t.getPath(),f=c;if(i===l)return{severity:"warning"===s?s:"error",excerpt:"none"===a?f:`${f} [${a.toUpperCase()}]`,location:{file:l,position:vo.generateRange(t,Number(u)-1)}};if(!r.displaySchemaWarnings&&"warning"===s)return null;const p="warning"===s?"Schema parser warning: ":"Could not process schema or catalog: ",v=e.find((t=>t.path===i&&t.lang===a));return{severity:"warning",excerpt:p+f,location:{file:l,position:v?vo.generateRange(t,v.line):[[0,0],[0,0]]}}})(t,n,e)),$n,(t=>e=>D(t,e))(o),(t=>e=>Hr(e,t))("location.position[0][0]")));var u},yo=oo.getInstance(),bo={none:"",localparts:"w",all:"wn"},_o=(t,e)=>{const{body:r,clientData:n,filterFn:o,builderFn:a}=e,i=((t,e)=>{const{options:{editor:r},xmlCatalog:n,xIncludeAware:o,xIncludeFixupBaseUris:a,xIncludeFixupLanguage:i,currentSchemaProps:{lang:u,path:s},wildcardSuggestions:c}=t,{type:l,fragment:f,splitPoint:p}=e;return["A",l,f||"",p||"",["r",bo[c],o?"x":"",a?"f":"",i?"l":""].join(""),"UTF-8",r.getPath(),n||"",u+" "+(s||"")]})(t,e);return yo.sendRequest(i,r).then(Wn(JSON.parse,(t=>n?t.concat(n):t),to(o),ro(a),$n)).catch((()=>[]))},xo=({editor:t,bufferPosition:e})=>{let r=null;return t.scanInBufferRange(co.nextTagBracket,[e,t.getBuffer().getEndPosition()],(({matchText:t,range:e,stop:n})=>{t.startsWith("'")||t.startsWith('"')||("<"!==t&&(r=[e.start.row,e.start.column+t.length]),n())})),r},jo=(wo=" – ",t=>Dr(t,wo));var wo;const Po=(t,e,r)=>{const[n,o]=t.split("#");if("string"==typeof o){const t=`ns\${${++e}}`,a=n.replace(/\*/g,(()=>`\${${++e}}`)),i="*"===o?`\${${++e}}`:o;return{snippet:`${t}:${a}${r?`="\${${++e}}"`:""} xmlns:${t}="${i}"`,displayText:""===o?`${n} [no namespace]`:`${n} (${o})`,index:e}}return{snippet:`${n.replace(/\*/g,(()=>`\${${++e}}`))}${r?`="\${${++e}}"`:""}`,displayText:n,index:e}},Ao=(t,e)=>({value:r,documentation:n})=>{const{snippet:o,displayText:a}=Po(r,0,e);return{snippet:o,displayText:a,type:"attribute",replacementPrefix:t,description:n?jo(n):void 0,retrigger:e}},Io=t=>({value:e})=>e.startsWith(t),$o=(t,e)=>{const{options:r}=t,{editor:n,bufferPosition:o}=r,a=(t=>{const e=t.match(co.attStartFromAttName);return e?{prefix:e[1]||"",column:e.index}:null})(e);if(!a)return[];const i=xo(r);if(!i)return[];const{prefix:u,column:s}=a,c=n.getTextInBufferRange([[0,0],[o.row,s]]),l=n.getTextInBufferRange([o,i]),f=l.match(co.attEndFromAttName),p=f?l.substr(f[0].length):l,v=!f;return _o(t,{type:"N",body:c+p,filterFn:Io(u),builderFn:Ao(u,v)})},So=t=>{const e={"&":"&amp;","<":"&lt;",[t]:{'"':"&quot;","'":"&apos;"}[t]},r=new RegExp(Object.keys(e).join("|"),"g");return t=>t.replace(r,(t=>e[t]))},Oo=So('"'),Ro=So("'"),Fo=(t,e,r)=>({listItem:n,value:o,documentation:a})=>({snippet:r?Oo(o):Ro(o),displayText:o,type:"value",rightLabel:n?"List Item":void 0,replacementPrefix:n?e:t,description:a?jo(a):void 0}),Eo=(t,e)=>({value:r,listItem:n})=>r.startsWith(n?e:t),To=(t,e,r)=>{const{options:n}=t,{editor:o}=n,a="string.quoted.double.xml"===r,i=(({editor:t,bufferPosition:e},r)=>{const n=r?co.attStartFromAttValueDouble:co.attStartFromAttValueSingle;let o;return t.backwardsScanInBufferRange(n,[e,[0,0]],(({match:t,stop:e})=>{o=t,e()})),o?{name:o[1],prefix:o[2]||""}:null})(n,a);if(!i)return[];const u=xo(n);if(!u)return[];const{name:s,prefix:c}=i,l=(t=>{const e=t.match(co.endToken);return e?e[1]:""})(c),f=o.getTextInBufferRange([[0,0],u]),p=Buffer.byteLength(f);return _o(t,{type:"V",body:o.getText(),fragment:s,splitPoint:p,filterFn:Eo(c,l),builderFn:Fo(c,l,a)})},ko=(t,e)=>({value:r,empty:n,closing:o,attributes:a=[],documentation:i,snippet:u})=>{if(u)return{snippet:u,displayText:r,type:"tag",replacementPrefix:t,description:i,retrigger:!1};if(o){const n=e?"/"+r+">":"/"+r;return{snippet:n,displayText:n,type:"tag",replacementPrefix:t,description:"Closing Tag",retrigger:!1}}const[s,c]=r.split("#");let l=0;const f=s.replace(/\*/g,(()=>`\${${++l}}`)),p=l>0;let v,d,h;if(e){let t;if("string"==typeof c){t=[`xmlns="${"*"===c?`\${${++l}}`:c}"`],h=""===c?`${s} [no namespace]`:`${s} (${c})`}else t=[],h=s;const e=a.map((t=>{const{snippet:e,index:r}=Po(t,l,!0);return l=r,e})),r=[f].concat(t).concat(e).join(" ");d=n?r+"/>":`${r}>\${${++l}}</${f}>`,v=!p&&l>0}else h=s,d=f,v=!1;return{snippet:d,displayText:h,type:"tag",replacementPrefix:t,description:i?jo(i):void 0,retrigger:v}},Co=[{value:"!--  --\x3e",snippet:"!-- ${1} --\x3e",documentation:"Comment"},{value:"![CDATA[]]>",snippet:"![CDATA[${1}]]>",documentation:"CDATA Section"}],Do=(t,{autocompleteScope:e,wildcardSuggestions:r})=>([,{schemaProps:n,xmlCatalog:o,xIncludeAware:a,xIncludeFixupBaseUris:i,xIncludeFixupLanguage:u}])=>{const s=n.find((({lang:t})=>!!e[t]))||{type:"none"},c=t.scopeDescriptor.getScopesArray(),l={options:t,xmlCatalog:o,xIncludeAware:a,xIncludeFixupBaseUris:i,xIncludeFixupLanguage:u,currentSchemaProps:s,wildcardSuggestions:r},f=(({editor:t,bufferPosition:e})=>t.getTextInBufferRange([[e.row,0],e]))(t),p=(t=>{const e=t.match(co.tagNamePI);return e?e[1]||"":null})(f);if(null!==p)return((t,e)=>{const{options:r}=t,{editor:n,bufferPosition:o}=r,a=n.getTextInBufferRange([[0,0],[o.row,o.column-e.length-1]]),i=!xo(r);return _o(t,{type:"E",body:a,clientData:Co,filterFn:(u=e,({value:t,closing:e})=>e?("/"+t).startsWith(u):t.startsWith(u)),builderFn:ko(e,i)});var u})(l,p);if((t=>t.some((t=>t.startsWith("meta.tag.xml")||"meta.tag.no-content.xml"===t)))(c)){const e=c.find((t=>"string.quoted.double.xml"===t||"string.quoted.single.xml"===t));if(e)return To(l,0,e);if("<"===(({editor:t,bufferPosition:e})=>{let r=null;return t.backwardsScanInBufferRange(co.previousTagBracket,[e,[0,0]],(({matchText:t,stop:e})=>{t.startsWith("'")||t.startsWith('"')||(r=t,e())})),r})(t))return $o(l,f)}return[]},Lo=(t,e)=>({rootAttributes:r})=>r[t]===e,Bo=({grammarScope:t,pathRegex:e,rootNs:r,rootLocalName:n,rootAttributes:o,publicId:a})=>{const i=[];var u;if(t&&i.push((u=t,({rootScopes:t})=>t.includes(u))),e&&i.push((t=>{try{const e=new RegExp(t);return({filePath:t})=>e.test(t)}catch(e){return console.error(`Could not parse RegExp "${t}"`,e),()=>!1}})(e)),r&&i.push((t=>({rootNs:e})=>t===e)(r)),n&&i.push((t=>({rootLocalName:e})=>t===e)(n)),o)for(const t of Object.keys(o))i.push(Lo(t,o[t]));return a&&i.push((t=>({publicId:e})=>t===e)(t)),i.length?In(i):()=>!1},zo=Wn(ro((({test:t,outcome:e,settingsPath:r})=>{const n=Bo(t),o={},a=u.default.dirname(r);return e.xmlCatalog&&(o.xmlCatalog=u.default.resolve(a,e.xmlCatalog)),e.schemaProps&&(o.schemaProps=e.schemaProps.map((({path:t,lang:e})=>({path:u.default.resolve(a,t),lang:e})))),{test:n,outcome:Object.assign({},e,o)}})),(t=>t.sort(((t,e)=>e.priority-t.priority))));const No=oo.getInstance();let Uo;No.onError===oo.prototype.onError&&(No.onError=t=>{atom.notifications.addError(`[linter-autocomplete-jing] ${t.message}`,{detail:t.stack,dismissable:!0})});let qo=!1,Mo=!1;const Vo=new class{constructor(){this.parsedConfigRules=[],this.parsedPackageRules=[],this.parsedRules=[]}updateConfigRules(t){this.parsedConfigRules=zo(t),this.parsedRules=this.parsedConfigRules.concat(this.parsedPackageRules)}updatePackageRules(t){this.parsedPackageRules=zo(t),this.parsedRules=this.parsedConfigRules.concat(this.parsedPackageRules)}getParsedRules(){return this.parsedRules}},Wo=[],Go={},Yo=t=>(atom.notifications.addError(`[linter-autocomplete-jing] ${t.message}`,{detail:t.stack,dismissable:!0}),[]),Zo=t=>{No.isReadyPromise&&No.isReadyPromise.then((()=>No.sendRequest(t,null))).catch(Yo)},Jo=()=>{const t=atom.grammars.getGrammars(),e=Wn(ro("scopeName"),to((t=>e=>wn(e,t))("text.xml")))(t);Wo.splice(0,Wo.length,...e)},Xo=()=>{const t=atom.packages.getActivePackages(),e=Wn(eo("settings"),eo((({path:t,scopedProperties:e,properties:r=e})=>Wn((t=>e=>xr(e,t))([".text.xml","validation","rules"]),ro((({test:e,outcome:r})=>({test:e,outcome:r,settingsPath:t}))))(r))),$n)(t);Vo.updatePackageRules(e)},Ho=((t,e)=>Z(e,t))(500,(()=>{Jo(),Xo()}));var Ko={ServerProcess:oo,ruleManager:Vo,activate(){require("atom-package-deps").install("linter-autocomplete-jing"),Uo=new t.CompositeDisposable,Object.keys(atom.config.get("linter-autocomplete-jing")).forEach((t=>Uo.add(atom.config.observe(`linter-autocomplete-jing.${t}`,(t=>e=>{"rules"!==t?(Go[t]=e,No.isReady&&(["javaExecutablePath","jvmArguments"].includes(t)?No.exit():"schemaCacheSize"===t&&Zo(["S",e]))):Vo.updateConfigRules(e)})(t))))),Uo.add(atom.commands.add("atom-workspace",{"linter-autocomplete-jing:clear-schema-cache":()=>Zo(["C"])}));const e=()=>{Uo.add(atom.packages.onDidActivatePackage(Ho)),Uo.add(atom.packages.onDidDeactivatePackage(Ho))};qo?e():Uo.add(atom.packages.onDidActivateInitialPackages((()=>{qo=!0,Ho(),e()}))),No.ensureIsReady(Go).catch(Yo)},deactivate(){Uo.dispose(),No.exit()},provideLinter:()=>({name:"Jing",grammarScopes:Wo,scope:"file",lintsOnChange:!0,lint:t=>Promise.all([No.ensureIsReady(Go),po(t,Vo.getParsedRules(),Go)]).then(((t,e)=>([,r])=>mo(t,e,r))(t,Go)).catch(Yo)}),provideAutocomplete:()=>({selector:".text.xml",disableForSelector:".comment, .string.unquoted.cdata.xml",inclusionPriority:Go.autocompletePriority,excludeLowerPriority:!0,getSuggestions(t){return Mo?(e=t.editor,atom.commands.dispatch(atom.views.getView(e),"autocomplete-plus:cancel",{activatedManually:!1}),Mo=!1,null):Promise.all([No.ensureIsReady(Go),po(t.editor,Vo.getParsedRules(),Go)]).then(Do(t,Go)).catch(Yo);var e},onDidInsertSuggestion(t){const{editor:e,suggestion:r}=t;r.retrigger?setTimeout((()=>(t=>{atom.commands.dispatch(atom.views.getView(t),"autocomplete-plus:activate",{activatedManually:!1})})(e)),1):(Mo=!0,setTimeout((()=>{Mo=!1}),300))}})};module.exports=Ko;
//# sourceMappingURL=main.js.map
